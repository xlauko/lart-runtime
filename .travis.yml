language: cpp


os: linux
dist: bionic
sudo: required
cache: ccache

cache:
  directories:
    - ${TRAVIS_BUILD_DIR}/deps

stages:
  - name: Latest     # build jobs to run first and always
  - name: Validation # run other jobs
  - name: Legacy     # build with all other supported options

jobs:
  include:


env:
  global:
    - CFLAGS="-Qunused-arguments"
    - CXXFLAGS="-Qunused-arguments"
    - CC=clang-10
    - CXX=clang++10
  matrix:
    - TRAVIS_BUILD_TYPE=Debug
    - TRAVIS_BUILD_TYPE=Release

addons:
  apt:
    sources:
      - sourceline: "deb http://apt.llvm.org/bionic/ llvm-toolchain-bionic-10 main"
        key_url: "https://apt.llvm.org/llvm-snapshot.gpg.key"
      - sourceline: "ppa:ubuntu-toolchain-r/test"
    packages:
      - clang-10
      - ninja-build
      - clang-format

install:
  - export DEPS_DIR="${HOME}/deps"
  - mkdir -p ${DEPS_DIR} && cd ${DEPS_DIR}
  - echo ${TRAVIS_OS_NAME}
  - |
    if [ "${TRAVIS_OS_NAME}" = "linux" ]; then
      export CMAKE_URL="https://github.com/Kitware/CMake/releases/download/v3.17.0/cmake-3.17.0-Linux-x86_64.tar.gz";
      mkdir cmake;
      travis_retry wget --no-check-certificate -O - ${CMAKE_URL} | tar --strip-components=1 -xz -C cmake;
      export PATH=${DEPS_DIR}/cmake/bin:${PATH};
      echo ${PATH};
    fi
  - cmake --version